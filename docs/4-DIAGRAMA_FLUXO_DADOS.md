# ðŸ”„ FLUXO DE DADOS DETALHADO - Lente CidadÃ£

## 1ï¸âƒ£ EXTRAÃ‡ÃƒO (CÃ¢mara API â†’ Backend)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          CÃ‚MARA DOS DEPUTADOS (Dados Abertos)           â”‚
â”‚  https://dadosabertos.camara.leg.br/api/v2/            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ CamaraExtractor (HTTP Client)
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                  â”‚              â”‚              â”‚
    â–¼                  â–¼              â–¼              â–¼
/deputados      /deputados/{id}   /proposicoes   /votacoes
   â””â”€â”€â”€â”€â”€â”            â”‚             â”‚            â”‚
         â”‚ [Raw JSON] â”‚             â”‚            â”‚
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  src/schemas/camara_api.py      â”‚
    â”‚  Pydantic Validation            â”‚
    â”‚  (Strict Mode)                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
         âœ… Valid  âŒ Invalid
         â”‚         â”‚
         â–¼         â–¼
    Processar    DLQ (Dead Letter Queue)
                 src/models/dlq.py
```

---

## 2ï¸âƒ£ INGESTÃƒO (ValidaÃ§Ã£o â†’ Database)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ResilienceIngestor                  â”‚
â”‚  (src/services/resilience_ingestor)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚             â”‚             â”‚
     â–¼             â–¼             â–¼
[Deputados]  [Gastos]    [ProposiÃ§Ãµes]
     â”‚             â”‚             â”‚
     â”œâ”€ Validate   â”œâ”€ Validate   â”œâ”€ Validate
     â”œâ”€ Normalize  â”œâ”€ Normalize  â”œâ”€ Normalize
     â””â”€ Upsert     â””â”€ Upsert     â””â”€ Upsert
                   â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚             â”‚                  â”‚
     â–¼             â–¼                  â–¼
PostgreSQL   ERROR?              âœ… Success
â””â”€ politicos     â”‚                   â”‚
â””â”€ partidos  [Retry x3]         Log ao BD
â””â”€ gastos    â””â”€ DLQ
â””â”€ empresas
â””â”€ proposicoes
â””â”€ autoria_proposicao
```

---

## 3ï¸âƒ£ ANÃLISE IA (Celery Async Task)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Route: POST /ingest/gastos/{id}    â”‚
â”‚  ou Endpoint Manual                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Celery Task Queue          â”‚
    â”‚ (Redis)                    â”‚
    â”‚                            â”‚
    â”‚ mass_analyze_pending_gastosâ”‚
    â”‚ (Cron ou Manual)           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼ [Fetch Gastos sem AnaliseIA]
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Batch Processing           â”‚
    â”‚ (atÃ© 20 gastos por vez)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Para cada Gasto:          â”‚
    â”‚ processar_analise_ia()    â”‚
    â”‚ (Celery Task)             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  GeminiClient                â”‚
    â”‚  (src/services/llm_service)  â”‚
    â”‚                              â”‚
    â”‚  analisar_gasto(texto)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Prompt + Structured Output Schema   â”‚
    â”‚                                     â”‚
    â”‚ "Analise este gasto:                â”‚
    â”‚  R$ 5000 para XYZ LTDA              â”‚
    â”‚  Tipo: CONSULTORIA                  â”‚
    â”‚  Data: 2026-01-15"                  â”‚
    â”‚                                     â”‚
    â”‚ Response JSON:                      â”‚
    â”‚ {                                   â”‚
    â”‚   "score_anomalia": 0.65,           â”‚
    â”‚   "resumo_critico": "...",          â”‚
    â”‚   "impacto_financeiro": "ALTO",     â”‚
    â”‚   "grupos_beneficiados": [...],     â”‚
    â”‚   "riscos_corrupcao": "..."         â”‚
    â”‚ }                                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Save AnaliseIA            â”‚
    â”‚  ao PostgreSQL             â”‚
    â”‚                            â”‚
    â”‚  analises_ia table         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         âœ… Success  (ou error + retry)
         â”‚
         â–¼
    Log: "âœ… AI Analysis completed"
```

**Rate Limiting:** 4 req/min (Gemini limit respeitado)  
**Retry:** Max 1 vez (autoretry_for=Exception)

---

## 4ï¸âƒ£ VISUALIZAÃ‡ÃƒO (Frontend)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        NEXT.JS FRONTEND (http://localhost:3000)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚              â”‚              â”‚
     â–¼              â–¼              â–¼
[HomePage]  [DeputadosList]  [GastosPage]
     â”‚              â”‚              â”‚
     â”‚ Stats API    â”‚ Deputados APIâ”‚ Gastos API
     â”‚ /stats/dash  â”‚ /deputados/  â”‚ /gastos/
     â”‚              â”‚              â”‚ exploration
     â–¼              â–¼              â–¼
  React Query (Cache + Fetch)
     â”‚              â”‚              â”‚
     â”œâ”€ GET http://backend:8000/stats/dashboard
     â”œâ”€ GET http://backend:8000/deputados/?limit=10
     â””â”€ GET http://backend:8000/gastos/exploration?...
                    â”‚
                    â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  FastAPI Routes         â”‚
       â”‚ (Rate Limited)          â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ PostgreSQL Queries â”‚
         â”‚ (SQLAlchemy)       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ JSON Response       â”‚
         â”‚ (Pydantic Schemas)  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
              (Volta ao React)
                   â”‚
                   â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Component Render     â”‚
         â”‚ - Card Gastos        â”‚
         â”‚ - Modal Deputado     â”‚
         â”‚ - Table ProposiÃ§Ãµes  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5ï¸âƒ£ FLUXO COMPLETO DE UMA REQUISIÃ‡ÃƒO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USUÃRIO CLICA: "Ver gastos de JoÃ£o Silva (jan/2026)"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Frontend envia:      â”‚
          â”‚ GET /gastos/         â”‚
          â”‚ exploration?         â”‚
          â”‚ politico_nome=JoÃ£o   â”‚
          â”‚ data_inicio=2026-01  â”‚
          â”‚ data_fim=2026-01-31  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼ (HTTP Request)
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ FastAPI Routes (/gastos.py)    â”‚
       â”‚ get_gastos_exploration()       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼ (Apply Filters)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ SQLAlchemy Query Builder        â”‚
    â”‚                                 â”‚
    â”‚ SELECT Gasto, Politico.nome,    â”‚
    â”‚        Partido.sigla,           â”‚
    â”‚        AnaliseIA.resumo         â”‚
    â”‚ FROM gastos_gabinete g          â”‚
    â”‚ JOIN politicos p ON ...         â”‚
    â”‚ JOIN partidos p ON ...          â”‚
    â”‚ LEFT JOIN analises_ia a ON ...  â”‚
    â”‚ WHERE p.nome LIKE '%JoÃ£o%'      â”‚
    â”‚   AND g.data >= '2026-01-01'    â”‚
    â”‚   AND g.data <= '2026-01-31'    â”‚
    â”‚ ORDER BY g.valor DESC           â”‚
    â”‚ OFFSET 0 LIMIT 20               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼ (PostgreSQL Execution)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ [Result: 15 Gastos]     â”‚
    â”‚ [Processo em milissegundos] â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼ (Pydantic Validation)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Schema: List[GastoBuscado]  â”‚
    â”‚ - id: 123                   â”‚
    â”‚ - data: 2026-01-15          â”‚
    â”‚ - valor: 5000.00            â”‚
    â”‚ - tipo: "CONSULTORIA"       â”‚
    â”‚ - fornecedor: "XX.XXX.XXX"  â”‚
    â”‚ - politico: "JoÃ£o Silva"    â”‚
    â”‚ - partido: "PT"             â”‚
    â”‚ - ai_resumo: "Gasto elevado â”‚
    â”‚   para consultoria..."      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼ (JSON Response)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ HTTP 200 OK                  â”‚
    â”‚ Content-Type: application/json
    â”‚                              â”‚
    â”‚ {                            â”‚
    â”‚   "items": [                 â”‚
    â”‚     { ... 15 gastos ... }    â”‚
    â”‚   ],                         â”‚
    â”‚   "total": 15,               â”‚
    â”‚   "page": 1,                 â”‚
    â”‚   "page_size": 20            â”‚
    â”‚ }                            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼ (React Query Cache)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Cache Data (5 min)           â”‚
    â”‚ queryKey: ['gastos', {...}]  â”‚
    â”‚                              â”‚
    â”‚ Se usuÃ¡rio voltar em < 5min: â”‚
    â”‚ Usa cache (sem nova request) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼ (Component Render)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ GastosExploration Component  â”‚
    â”‚ â”œâ”€ Header com filters        â”‚
    â”‚ â”œâ”€ Table com 15 gastos       â”‚
    â”‚ â”‚  â”œâ”€ Data: 15/01/2026       â”‚
    â”‚ â”‚  â”œâ”€ Valor: R$ 5.000        â”‚
    â”‚ â”‚  â”œâ”€ Tipo: CONSULTORIA      â”‚
    â”‚ â”‚  â”œâ”€ Fornecedor: XX...      â”‚
    â”‚ â”‚  â””â”€ Resumo IA: "Elevado"   â”‚
    â”‚ â””â”€ Pagination (Page 1 of 1)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ USUÃRIO VÃŠ:              â”‚
    â”‚ "15 gastos de JoÃ£o Silva"â”‚
    â”‚ em janeiro de 2026       â”‚
    â”‚ com anÃ¡lise IA           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6ï¸âƒ£ FLUXO DE INGESTÃƒO (Background)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ADMIN DISPARA: curl -X POST /ingest/deputados â”‚
â”‚  OU Celery Beat (agendado)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ API Endpoint Handler â”‚
        â”‚ POST /ingest/        â”‚
        â”‚ deputados            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ CamaraExtractor          â”‚
        â”‚ .get_deputados()         â”‚
        â”‚ [Fetch de 600 deputados] â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Pagina_size: 100         â”‚
        â”‚ Requests: 6 (com retry)  â”‚
        â”‚ Timeout: 30s             â”‚
        â”‚ Resultado: Raw JSON      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ResilienceIngestor                 â”‚
    â”‚ .process_deputados_batch()         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚
        â–¼             â–¼
    [Validate]  [Normalize]
        â”‚             â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Para cada deputado:      â”‚
    â”‚ â”œâ”€ Check se existe       â”‚
    â”‚ â”‚  (pelo ID CÃ¢mara)      â”‚
    â”‚ â”œâ”€ Update se mudou       â”‚
    â”‚ â””â”€ Insert se novo        â”‚
    â”‚                          â”‚
    â”‚ Batch INSERT/UPDATE      â”‚
    â”‚ (Eficiente)              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
         âœ… Sucesso
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PostgreSQL Updated:  â”‚
    â”‚ politicos += 600     â”‚
    â”‚ partidos += 30       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Response ao UsuÃ¡rio:     â”‚
    â”‚ {                        â”‚
    â”‚   "status": "Deputados   â”‚
    â”‚    population finished", â”‚
    â”‚   "count": 600           â”‚
    â”‚ }                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    Tempo total: ~5-10 segundos

    Se hÃ¡ erro em algum deputado:
    - Retry 3x com backoff
    - Se falhar sempre: â†’ DLQ
    - Continue processando resto
```

---

## 7ï¸âƒ£ CICLO DE VIDA DO DADO

```
DAY 1: EXTRAÃ‡ÃƒO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CÃ¢mara API              â”‚
â”‚ (dados pÃºblicos)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ CamaraExtractor.get_*()
         â–¼
    [Raw JSON]
    
DAY 1: INGESTÃƒO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ResilienceIngestor      â”‚
â”‚ Validate + Normalize    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    PostgreSQL
    (Politicos, Gastos, ProposiÃ§Ãµes)

CONTINUOUS: ANÃLISE IA
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Celery Worker           â”‚
â”‚ Gemini LLM Analysis     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    AnaliseIA table
    (Scores, Riscos, Resumos)

CONTINUOUS: VISUALIZAÃ‡ÃƒO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ React Components        â”‚
â”‚ (Dashboard, Lists)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    Frontend User Interface
    (Dashboard, Modals, Filters)

SECURITY: MONITORAMENTO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Flower UI               â”‚
â”‚ (Celery Monitoring)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    Admin views task status
    (Queue depth, worker health)
```

---

## ðŸŽ¯ EXEMPLO REAL: Analisando Gastos de Um Deputado

```
USUÃRIO FINAL                  FRONTEND                 BACKEND
     â”‚                            â”‚                         â”‚
     â”œâ”€ Clica "Explorar"          â”‚                         â”‚
     â”‚  gastos de JoÃ£o Silva  â”€â”€â”€â”€>â”‚                         â”‚
     â”‚                            â”‚ GET /gastos/            â”‚
     â”‚                            â”‚ exploration?            â”‚
     â”‚                            â”‚ politico_nome=JoÃ£o  â”€â”€â”€â”€>â”‚
     â”‚                            â”‚                         â”‚
     â”‚                            â”‚                         â”œâ”€ Query Builder
     â”‚                            â”‚                         â”‚
     â”‚                            â”‚                         â”œâ”€ SQL Query
     â”‚                            â”‚                         â”‚
     â”‚                            â”‚                         â”œâ”€ Get 50 gastos
     â”‚                            â”‚                         â”‚
     â”‚                            â”‚<â”€â”€â”€â”€â”€â”€[JSON 50 gastos]â”€â”€â”‚
     â”‚                            â”‚                         â”‚
     â”‚<â”€â”€â”€[Carregou] (React Query)â”€â”‚                         â”‚
     â”‚                            â”‚                         â”‚
     â”œâ”€ VÃª tabela com:            â”‚                         â”‚
     â”‚ â”œâ”€ Datas                   â”‚                         â”‚
     â”‚ â”œâ”€ Valores                 â”‚                         â”‚
     â”‚ â”œâ”€ Fornecedores            â”‚                         â”‚
     â”‚ â””â”€ Resumo IA               â”‚                         â”‚
     â”‚                            â”‚                         â”‚
     â”œâ”€ Clica em 1 gasto          â”‚                         â”‚
     â”‚ (valor: R$ 8.500)          â”‚                         â”‚
     â”‚                            â”‚                         â”‚
     â”‚                            â”œâ”€ Fetch detalhe  â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                            â”‚ AnaliseIA deste gasto   â”‚
     â”‚                            â”‚                         â”‚
     â”‚                            â”‚<â”€â”€[AnÃ¡lise IA completa]â”€â”‚
     â”‚                            â”‚                         â”‚
     â”‚<â”€â”€â”€â”€[Modal aberto]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚
     â”‚                            â”‚                         â”‚
     â”œâ”€ VÃª popup modal com:       â”‚                         â”‚
     â”‚ â”œâ”€ Score: 0.72 (Alto)      â”‚                         â”‚
     â”‚ â”œâ”€ Risco: "PossÃ­vel..."    â”‚                         â”‚
     â”‚ â”œâ”€ Beneficiados: [...]     â”‚                         â”‚
     â”‚ â””â”€ URL da nota fiscal      â”‚                         â”‚
     â”‚                            â”‚                         â”‚
     â””â”€ Clica link externo        â”‚                         â”‚
      (nota fiscal original)      â”‚                         â”‚
           Abre no navegador      â”‚                         â”‚

Total time: ~500-800ms
Cache utilizado: Sim
Rate limit: 1/5 req consumidos
```

---

## ðŸ”„ RESUMO VISUAL DO PIPELINE

```
INPUT                  PROCESSING              OUTPUT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
CÃ¢mara API       â†’  CamaraExtractor    â†’   Raw JSON
                    (HTTP Client)

Raw JSON         â†’  ResilienceIngestor â†’   PostgreSQL
                    (Validate+Normalize)   Tables

PostgreSQL       â†’  Celery Worker      â†’   AnaliseIA
                    (Gemini LLM)        â†’   Table

Database         â†’  React Query        â†’   Frontend
                    (Cache + Fetch)     â†’   Components

Components      â†’  Tailwind CSS        â†’   User View
                   (Styling)

User Action     â†’  Event Handler       â†’  State Update
                   (onClick, onChange)

State Update    â†’  Component Rerender  â†’  UI Updated
```

---

**Diagrama Atualizado: 28 de Janeiro de 2026**

